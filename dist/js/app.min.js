function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function removeSlash(t){return t.replace(/\/$/,"")}function goToByScroll(t){$("html,body").animate({scrollTop:t.offset().top-65},"slow")}function isLocalStorageNameSupported(){var t="test",e=window.sessionStorage;try{return e.setItem(t,"1"),e.removeItem(t),!0}catch(o){return!1}}function notifyUser(t,e){var o=$("#notification"),i=o.find(".message");o.addClass(e).removeClass("hide"),i.text(t),clearTimeout(t1),clearTimeout(t2),t1=window.setTimeout(function(){o.addClass("hide"),t2=window.setTimeout(function(){o.removeClass(e),i.text("")},1e3)},3500)}var config={lang:"en",routes:[{title:"Home",id:"home",slug:["/home","/",""],hbsPath:"/pages/home"},{title:"Rings",id:"rings",slug:["/rings","/ringe"],hbsPath:"/pages/rings"},{title:"Necklaces",id:"necklaces",slug:["/necklaces"],hbsPath:"/pages/necklaces"},{title:"Bracelets",id:"bracelets",slug:["/bracelets"],hbsPath:"/pages/bracelets"},{title:"Checkout",id:"checkout",slug:["/checkout"],hbsPath:"/pages/checkout"},{title:"Imprint",id:"imprint",slug:["/imprint"],hbsPath:"/pages/imprint"},{title:"Developer Page",id:"f12",slug:["/f12"],hbsPath:"/pages/f12"},{title:"404",id:"404",slug:["/404"],hbsPath:"/pages/404"}]},t1,t2;jQuery.fn.addTempClass=function(t,e){var o=$(this[0]);o.addClass(t),window.setTimeout(function(){o.removeClass(t)},e)};var App=function(){var t=this;this.model=config,this.updateFromLocalStorage(),this.getCopy().then(function(){t.getProducts()}),this.initRouting(),this.initNavigation()};App.changeLanguageTo=function(t){this.model.lang=t,this.getCopy().then(function(){})},App.prototype.getCopy=function(){return $.getJSON("copy/"+this.model.lang+".json",function(t){einzl.copy=t.copy,einzl.deferreds.copy.resolve()}).done(function(){$("[data-copy]").each(function(){var t=einzl.copy[$(this).attr("data-copy")];$(this).html(t)}),window.setTimeout(function(){notifyUser(einzl.copy.messages.welcome[getRandomInt(0,einzl.copy.messages.welcome.length-1)],"success")},2e3)})},App.prototype.updateFromLocalStorage=function(){if(isLocalStorageNameSupported()&&localStorage.einzl_user){var t=JSON.parse(localStorage.einzl_user);$.extend(einzl.user,t)}},App.prototype.getProducts=function(){var t=this,e={action:"getProducts"};return this.askServer(e).done(function(e){e&&e.status?t.getTemplate("modules/product").then(function(t){einzl.templates.product=t,$.each(e.result,function(t){einzl.products[t]=new Product(this)}),einzl.deferreds.product.resolve()}):(console.log("GET PRODUCTS FAILED"),console.log(e))})},App.prototype.askServer=function(t){return $.ajax({type:"POST",dataType:"json",url:"php/ajax.php",data:t}).done(function(){}).fail(function(e,o,i){console.log("AJAX Call failed"),console.log("tried to send this data:"),console.log(t),console.log("response data:"),console.log(e),console.log(o),console.log(i)})},App.prototype.initNavigation=function(){$(".hamburger-button").on("vclick",function(){$("header nav").toggleClass("open")}),$(".cart-button").on("vclick",function(){$("aside.cart-container").toggleClass("open")}),this.initAppRoutingLinks()},App.prototype.initAppRoutingLinks=function(){Modernizr.history&&($("a").off("vclick"),$("a").not('[target="_blank"]').on("vclick",function(t){t.preventDefault(),t.stopPropagation();var e=$(this).attr("href"),o=$(this).attr("title"),i=window.location.pathname;i!==e&&History.pushState("",o,e)}))},App.prototype.subscribe=function(t){var e={action:"subscribe",user:t};return this.askServer(e).done(function(t){console.log("user successfully subscribed"),console.log(t),notifyUser(einzl.copy.messages.nl_subscribed,"success")}).fail(function(t){console.log("something is wrong with that email"),console.log(t),notifyUser(einzl.copy.messages.nl_error,"error")})},App.prototype.findDestination=function(t){var e=null;return $.each(this.model.routes,function(){var o=!1;return $.each(this.slug,function(e,i){return i===t?(o=!0,!1):void 0}),o?(e=this,!1):void 0}),e?e:this.findDestination("/404")},App.prototype.route=function(t){t||(t=removeSlash(window.location.pathname)),console.log("route to: "+t);var e=this.findDestination(t);einzl.pages[e.id]&&einzl.pages[e.id].view.length>0?einzl.pages[e.id].start():(einzl.pages[e.id]=new Page(e),einzl.pages[e.id]="checkout"==e.id?new Checkout(e):new Page(e),einzl.pages[e.id].start()),document.title=e.title+" - EinzelstÃ¼ck",ga("send","pageview"),$("header nav a").removeClass("active").filter('[href="'+e.slug[0]+'"]').addClass("active")},App.prototype.getTemplate=function(t){return $.get("/templates/"+t+".hbs").then(function(t){return Handlebars.compile(t)})},App.prototype.initRouting=function(){var t=this,e=window.History;e.Adapter.bind(window,"statechange",function(){e.getState();t.route(null)})},$(document).ready(function(){window.einzl={pages:{},user:{likes:{}},products:[],templates:{},deferreds:{product:new $.Deferred,copy:new $.Deferred}},einzl.app=new App(config),einzl.app.route(null),einzl.cart=new Cart,ga("create","UA-46833918-1","auto")});var Page=function(t){this.model=t};Page.prototype.createView=function(){var t=this;return einzl.app.getTemplate(this.model.hbsPath).then(function(e){var o=e();t.view=$(o),$.when(einzl.deferreds.copy).then(function(){t.insertCopy()}),$.when(einzl.deferreds.product).then(function(){t.insertProducts()}),t.initController()})},Page.prototype.insertCopy=function(){this.view.find("[data-copy]").each(function(){var t=einzl.copy[$(this).attr("data-copy")];$(this).html(t)})},Page.prototype.initController=function(){this.view.find(".newsletter-form").each(function(){var t=$(this),e=t.find('input[type="email"]'),o=t.find('button.subscribe[type="submit"]');o.on("vclick",function(i){if(i.stopImmediatePropagation(),i.stopPropagation(),i.preventDefault(),!o.hasClass("loading"))if(t[0].checkValidity()&&e.val().length>0){o.addClass("loading");var n={email:e.val()};einzl.app.subscribe(n).always(function(){o.removeClass("loading"),e.val("")}).done(function(){o.addTempClass("success",2e3)}).fail(function(){o.addTempClass("fail",2e3)})}else e.addClass("error"),e.one("focus",function(){e.removeClass("error")})})})},Page.prototype.insertProducts=function(){this.view.find("[data-product]").each(function(){var t=$(this),e=t.attr("data-product");$.each(einzl.products,function(){var o=this.model.id;return e===o?(this.view.clone(!0).appendTo(t),!1):void 0})})},Page.prototype.start=function(){var t=this;this.view?(einzl.pages.active=this,$("main").children("section").detach(),$(window).scrollTop(0),this.view.appendTo($("main"))):this.createView().then(function(){t.start()})};var Cart=function(){var t=this;this.getCart().then(function(){t.getTemplate().then(function(){t.createView(),t.initController()})})};Cart.prototype.removeItem=function(t){var e=this;console.log("remove product "+t);var o={action:"removeFromCart",cart:{id:e.model.id},product:{key:t,quantity:e.model.contents[t].quantity}};return einzl.app.askServer(o).done(function(t){e.model=t.cart,e.createView()})},Cart.prototype.addItem=function(t){var e=this,o={action:"addToCart",cart:{id:e.model.id},product_id:t};return einzl.app.askServer(o).done(function(t){e.model=t.cart,e.createView()})},Cart.prototype.getCart=function(){var t=this,e={action:"getCart",cart:{id:einzl.user.cart_id?einzl.user.cart_id:null}};return einzl.app.askServer(e).done(function(e){console.log(e),t.model=e.cart,einzl.user.cart_id=e.cart.id,isLocalStorageNameSupported()&&(localStorage.einzl_user=JSON.stringify(einzl.user))})},Cart.prototype.getTemplate=function(){var t=this;return einzl.app.getTemplate("modules/cart").then(function(e){t.template=e})},Cart.prototype.initController=function(){var t=this,e=$(".cart");e.on("vclick",".button.checkout",function(){}),e.on("vclick",".remove",function(e){var o=$(e.currentTarget).closest("li.item"),i=$(this).closest("li").attr("data-product-key");console.log(o),o.hasClass("loading")||(o.addClass("loading"),t.removeItem(i))})},Cart.prototype.createView=function(){var t=this.template(this.model);this.view=$(t),$(".cart").html(""),this.view.clone(!0).appendTo($(".cart")),einzl.app.initAppRoutingLinks(),$(".total-items").text(this.model.total_items),$(".total-price").text(this.model.totals.formatted.with_tax)};var Checkout=function(t){console.log("this is checkout calling"),this.model=t,Page.apply(this,arguments)};Checkout.prototype=Object.create(Page.prototype),Checkout.prototype.constructor=Checkout,Checkout.prototype.initController=function(){};var Product=function(t){this.model=t,this.createView()};Product.prototype.createView=function(){var t=einzl.templates.product(this.model);this.view=$(t),this.initController()},Product.prototype.addToCart=function(){return console.log(this.model),einzl.cart.addItem(this.model.id)},Product.prototype.initController=function(){var t=this;this.view.find(".drop.plus").on("vclick",function(){$(this).closest(".details").toggleClass("collapsed expanded")}),this.view.find(".drop.add-to-cart").on("vclick",function(){var e=$(this);e.addClass("loading"),t.addToCart().always(function(){e.removeClass("loading")}).done(function(){e.addTempClass("success",1500)}).fail(function(){e.addTempClass("fail",1500)})}),this.view.find(".drop.like").on("vclick",function(){$(this).toggleClass("liked");var e=$(this).hasClass("liked");e?ga("send","event","product",t.model.id,"liked"):ga("send","event","product",t.model.id,"unliked"),einzl.user.likes[t.model.id]=e,isLocalStorageNameSupported()&&(localStorage.einzl_user=JSON.stringify(einzl.user))}),einzl.user.likes[this.model.id]&&this.view.find(".drop.like").addClass("liked")};