function validateForm(e){if($(e).find("[required]").each(function(){var e=$(this);0===e.val().length&&(e.closest("div").addClass("error"),e.one("focus",function(){e.closest("div").removeClass("error")}))}),$(e).find(".error").length>0)return notifyUser(Einzlstck.Models.Copy.data.messages.form_empty_input,"error"),!1;var t=$(e).find(".email input");return t.get(0).checkValidity()?e.checkValidity()?!0:!1:(t.closest("div").addClass("error"),t.one("focus",function(){t.closest("div").removeClass("error")}),notifyUser(Einzlstck.Models.Copy.data.messages.form_email_invalid,"error"),!1)}function guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function removeSlash(e){return e.replace(/\/$/,"")}function goToByScroll(e){$("html,body").animate({scrollTop:e.offset().top-65},"slow")}function isLocalStorageNameSupported(){var e="test",t=window.sessionStorage;try{return t.setItem(e,"1"),t.removeItem(e),!0}catch(n){return!1}}function getUrlParams(){var e=location.search.substring(1),t=e?JSON.parse('{"'+e.replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,t){return""===e?t:decodeURIComponent(t)}):{};return t}function notifyUser(e,t){var n=$("#notification"),s=n.find(".message");n.removeClass("success info error").addClass(t).removeClass("hide"),s.text(e),clearTimeout(t1),clearTimeout(t2),t1=window.setTimeout(function(){n.addClass("hide"),t2=window.setTimeout(function(){n.removeClass(t),s.text("")},1e3)},4500)}var config=[{title:{en:"Home",de:"Home"},id:"home",slug:["/home","/",""],hbsPath:"/pages/home.hbs"},{title:{en:"Rings",de:"Ringe"},id:"rings",slug:["/rings","/ringe"],hbsPath:"/pages/rings.hbs"},{title:{en:"Testpage",de:"Testpage"},id:"testpage",slug:["/testpage"],hbsPath:"/pages/testpage.hbs"},{title:{en:"Necklaces",de:"Ketten"},id:"necklaces",slug:["/necklaces","/ketten"],hbsPath:"/pages/necklaces.hbs"},{title:{en:"Pendants",de:"Anhänger"},id:"pendants",slug:["/pendants","/anhaenger"],hbsPath:"/pages/pendants.hbs"},{title:{en:"Bracelets",de:"Armbänder"},id:"bracelets",slug:["/bracelets","/armbaender","/armband"],hbsPath:"/pages/bracelets.hbs"},{title:{en:"Product",de:"Produkt"},id:"product",slug:["/product/:id"],hbsPath:"/pages/productDetails.hbs"},{title:{en:"<3",de:"<3"},id:"likes",slug:["/likes","/yourlikes","/mylikes"],hbsPath:"/pages/likes.hbs"},{title:{en:"Checkout",de:"Kasse"},id:"checkout",slug:["/checkout","/kasse"],hbsPath:"/pages/checkout.hbs"},{title:{en:"Confirmation",de:"Bestätigung"},id:"confirmation",slug:["/confirmation/:orderID"],hbsPath:"/pages/confirmation.hbs"},{title:{en:"Gateway",de:"Zahlung"},id:"gateway",slug:["/gateway"]},{title:{en:"GTC",de:"AGB"},id:"terms",slug:["/terms","/agb"],hbsPath:"/pages/terms.hbs"},{title:{en:"Imprint",de:"Impressum"},id:"imprint",slug:["/imprint","/impressum"],hbsPath:"/pages/imprint.hbs"},{title:{en:"Shipping & Retour",de:"Versand & Rückgabe"},id:"shipping",slug:["/shipping","/versand"],hbsPath:"/pages/shipping.hbs"},{title:{en:"Privacy",de:"Datenschutz"},id:"privacy",slug:["/privacy","/datenschutz"],hbsPath:"/pages/privacy.hbs"},{title:{en:"The Brand",de:"Die Marke"},id:"brand",slug:["/brand","/marke"],hbsPath:"/pages/brand.hbs"},{title:{en:"Developer Page",de:"Entwickler Seite"},id:"f12",slug:["/f12"],hbsPath:"/pages/f12.hbs"},{title:{en:"404",de:"404"},id:"404",slug:["/404"],hbsPath:"/pages/404.hbs"}],t1,t2;jQuery.fn.addTempClass=function(e,t){var n=$(this[0]);n.addClass(e),window.setTimeout(function(){n.removeClass(e)},t)};var Router=Backbone.Router.extend({initialize:function(e){this.config=e,$("body").addClass("loading"),$(document).on("vclick",'a:not([target="_blank"])',function(e){e.preventDefault();var t=$(this).attr("href");Einzlstck.Router.navigate(t,!0),$(".hamburger-button").removeClass("open"),$("header nav").removeClass("open"),Einzlstck.Models.Cart.view.close()})},execute:function(e,t){$(".hamburger-button").removeClass("open"),$("header nav").removeClass("open"),Einzlstck.Models.Cart.view.close(),$("body").addClass("loading"),$("main section").remove(),e&&e.apply(this,t)},routes:{checkout:"checkout",kasse:"checkout",gateway:"gateway","product/:id":"product","p/:id":"product","confirmation/:orderID":"confirmation","":"page",":page":"page","*default":"notfound"},product:function(e){var t="/product/:id";console.log("product id: "+e);this.getRouteConfig(t);Einzlstck.Deferreds.products.then(function(){var t=Einzlstck.Models.Inventory.selectProduct(e);t.view.render(t.data),document.title=t.data.title+" - "+t.data.category.value+" - Einzelstück"}),$("header nav a").removeClass("active")},notfound:function(){var e="/404",t=this.getRouteConfig(e);Einzlstck.Pages[t.id]||(Einzlstck.Pages[t.id]=new PageModel(t)),Einzlstck.Pages[t.id].view.render()},page:function(e){var t=e?"/"+e:"/",n=this.getRouteConfig(t);Einzlstck.Pages[n.id]||(Einzlstck.Pages[n.id]=new PageModel(n)),Einzlstck.Pages[n.id].view.render(),document.title=n.title.de+" - Einzelstück",$("header nav a").removeClass("active").filter('[href="'+n.slug[0]+'"]').addClass("active")},checkout:function(){var e="/checkout",t=this.getRouteConfig(e);Einzlstck.Pages[t.id]||(Einzlstck.Pages[t.id]=new CheckoutModel(t)),Einzlstck.Pages[t.id].view.render(),document.title=t.title.de+" - Einzelstück",$("header nav a").removeClass("active")},confirmation:function(e){var t="/confirmation/:orderID",n=this.getRouteConfig(t);n.order={id:e},Einzlstck.Pages[n.id]=new OrderModel(n),document.title=n.title.de+" - Einzelstück",$("header nav a").removeClass("active")},gateway:function(){var e="/confirmation/:orderID",t=this.getRouteConfig(e);t.urlParams=getUrlParams(),Einzlstck.Pages[t.id]=new GatewayModel(t)},getRouteConfig:function(e){var t=null;return $.each(this.config,function(){var n=!1;return $.each(this.slug,function(t,s){return s===e?(n=!0,!1):void 0}),n?(t=this,!1):void 0}),t?t:this.getRouteConfig("/404")}}),PageView=Backbone.View.extend({render:function(e){var t=this;return this.template.then(function(n){var s=n(e);t.el=$(s),$("html, body").scrollTop(0),$("main").html(t.el),$("body").removeClass("loading"),t.initController(),Einzlstck.Deferreds.products.then(function(){t.insertProducts()})})},initialize:function(e){var t=this;this.template=$.Deferred(),Einzlstck.Models.Shop.getTemplate(e).then(function(e){t.template.resolve(e)})},insertProducts:function(){this.el.find("[data-product]").each(function(){var e=$(this),t=e.attr("data-product"),n=Einzlstck.Models.Inventory.selectProduct(t);$.when(n.extractView.template).then(function(){n.extractView.el.clone(!0).appendTo(e)})}),this.el.find("[data-product-category]").each(function(){var e=$(this),t=e.attr("data-product-category");$.each(Einzlstck.Models.Inventory.models,function(){if(this.data.category.data[t]){var n=Einzlstck.Models.Inventory.selectProduct(this.data.id);$.when(n.extractView.template).then(function(){n.extractView.el.clone(!0).appendTo(e)})}})})},initController:function(){this.el.find(".newsletter-form").each(function(){var e=$(this),t=e.find('input[type="email"]'),n=e.find('button.subscribe[type="submit"]');n.on("vclick",function(s){if(s.stopImmediatePropagation(),s.stopPropagation(),s.preventDefault(),!n.hasClass("loading"))if(e[0].checkValidity()&&t.val().length>0){n.addClass("loading");var i={email:t.val()};Einzlstck.Models.Shop.subscribe(i).always(function(){n.removeClass("loading"),t.val("")}).done(function(){n.addTempClass("success",2e3)}).fail(function(){n.addTempClass("fail",2e3)})}else t.addClass("error"),t.one("focus",function(){t.removeClass("error")})})})}}),AddressList=Backbone.View.extend({initialize:function(){this.template=Einzlstck.Models.Shop.getTemplate("/modules/addressList.hbs")},render:function(e){var t=this;return this.template.then(function(n){var s=n(e);t.el=$(s),t.el.find("li:first-child").addClass("selected"),t.initController(),$(".user-address-list").html(""),t.el.clone(!0).appendTo($(".user-address-list"))})},initController:function(){}}),AddressForm=Backbone.View.extend({initialize:function(){this.template=Einzlstck.Models.Shop.getTemplate("/modules/addressForm.hbs")},render:function(e){var t=this;return this.template.then(function(n){var s=n(e);t.el=$(s),t.initController(),$(".new-address-form").html(""),t.el.clone(!0).appendTo($(".new-address-form"))})},initController:function(){var e=this;this.el.find('button[type="reset"]').on("vclick",function(t){$(t.currentTarget).closest(".unit").removeClass("open-form"),e.el.get(0).reset(),$(":focus").blur(),$(window).scrollTop($("#billing-address").offset().top),t.preventDefault(),t.stopPropagation()}),this.el.find('button[type="submit"]').on("vclick",function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).closest("form");if(!validateForm(t[0]))return!1;var n={};n.first_name=t.find(".firstname input").val(),n.last_name=t.find(".lastname input").val(),n.email=t.find(".email input").val(),n.phone="000",n.address_1=t.find(".address_1 input").val(),n.postcode=t.find(".code input").val(),n.city=t.find(".city input").val(),n.county="--",n.country=t.find(".country select").val(),n.note=t.find(".note textarea").val(),n.id=guid(),Einzlstck.Models.User.addAddress(n).then(function(){t.get(0).reset(),$(".open-form").removeClass("open-form")})})}}),BasketView=Backbone.View.extend({template:$.Deferred(),initialize:function(){var e=this;Einzlstck.Models.Shop.getTemplate("modules/cart.hbs").then(function(t){e.template.resolve(t)})},close:function(){$(".cart-button").removeClass("open"),$("aside.cart-container").removeClass("open"),$("body").removeClass("no-scroll-mobile")},open:function(){$(".cart-button").addClass("open"),$("aside.cart-container").addClass("open"),$("body").addClass("no-scroll-mobile")},render:function(e){var t=this;return console.log("render cart"),$.each(e.contents,function(){this.pricing.rounded.with_tax=this.pricing.rounded.with_tax.toFixed(2),this.pricing.rounded.without_tax=this.pricing.rounded.without_tax.toFixed(2)}),this.template.then(function(n){var s=n(e);t.el=$(s),t.initController(),$(".cart").html(t.el.clone(!0)),$(".total-items").text(e.total_items),$(".total-price").text(e.totals.post_discount.rounded.with_tax.toFixed(2))})},initController:function(){this.el.find(".item").off("vclick"),this.el.find(".item").on("vclick",function(e){$(e.currentTarget).toggleClass("selected").siblings("li").removeClass("selected"),e.preventDefault(),e.stopPropagation()}),this.el.find(".remove").off("vclick"),this.el.find(".remove").on("vclick",function(e){var t=$(e.currentTarget).closest("li.item"),n=$(this).closest("li").attr("data-product-key");t.hasClass("loading")||(t.addClass("loading"),Einzlstck.Models.Cart.removeItem(n)),e.stopPropagation(),e.preventDefault()})}}),CheckoutView=PageView.extend({insertAddresses:function(){Einzlstck.Models.User.views.addressForm.render(),Einzlstck.Models.User.data.addresses.length>0?Einzlstck.Models.User.views.addressList.render(Einzlstck.Models.User.data):this.el.find("#billing-address").addClass("open-form")},initController:function(){PageView.prototype.initController.apply(this);var e=this;this.insertAddresses(),this.el.find(".new-address-button").on("vclick",function(e){$(e.currentTarget).closest(".unit").addClass("open-form")}),this.el.find(".button.buy").on("vclick",function(t){var n=$(t.currentTarget);n.hasClass("loading")||(n.addClass("loading"),e.model.processOrder().always(function(){n.removeClass("loading")}))}),this.el.find(".user-address-list").on("vclick","li",function(e){$(this).addClass("selected"),$(this).siblings("li").removeClass("selected"),e.preventDefault(),e.stopPropagation()});try{this.el.find(".cart").html(Einzlstck.Models.Cart.view.el.clone(!0))}catch(t){}$(".cart-container").removeClass("open"),$(".cart-button").removeClass("open")}}),OrderView=PageView.extend({initController:function(){PageView.prototype.initController.apply(this)}}),ProductViewExtract=Backbone.View.extend({template:$.Deferred(),initialize:function(){var e=this;Einzlstck.Models.Shop.getTemplate("modules/product.hbs").then(function(t){e.template.resolve(t)})},render:function(e){var t=this;return this.template.then(function(n){var s=n(e);t.el=$(s)})}}),ProductView=PageView.extend({template:$.Deferred(),initialize:function(){var e=this;Einzlstck.Models.Shop.getTemplate("pages/product.hbs").then(function(t){e.template.resolve(t)})},render:function(e){var t=this;PageView.prototype.render.call(this,e).then(function(){console.log(e),e.recommendations&&$.each(e.recommendations.data,function(){var e=Einzlstck.Models.Inventory.selectProduct(this.id);$.when(e.extractView.template).then(function(){e.extractView.el.clone(!0).appendTo(t.el.find(".recommended-products"))})})})},initController:function(){var e=this;this.el.find(".add-to-cart").on("vclick",function(t){var n=$(this);n.hasClass("loading")||(n.addClass("loading").removeClass("success fail"),e.model.addToCart().always(function(){n.removeClass("loading")}).done(function(){n.addTempClass("success",1500)}).fail(function(){n.addTempClass("fail",1500)})),t.preventDefault(),t.stopPropagation()}),0===this.model.data.stock_level&&this.el.addClass("out-of-stock"),this.model.data.recommendations&&this.el.addClass("has-recommendations"),this.el.find(".accordeon li").on("vclick",function(){var e=$(this);e.toggleClass("extended")});var t=$(".image-gallery .images img");console.log(t.length),this.el.find(".gallery-navigation .thumb").each(function(e){$(this).on("vclick",function(){t.eq(e).addClass("active").siblings("img").removeClass("active")})})}}),PageModel=Backbone.Model.extend({initialize:function(e){this.data=e,this.view=new PageView(this.data.hbsPath),this.view.model=this}}),ProductModel=Backbone.Model.extend({initialize:function(e){var t=this;this.data=e,this.view=new ProductView,this.view.model=this,this.extractView=new ProductViewExtract,this.extractView.render(this.data).then(function(){t.initController()})},addToCart:function(){return this.data.stock_level<=0?(notifyUser(this.data.title+" ist ausverkauft :-(","error"),$.Deferred().reject()):Einzlstck.Models.Cart.addItem(this.data.id)},initController:function(){var e=this;this.extractView.el.on("vclick",function(){Einzlstck.Router.navigate("/product/"+e.data.id,{trigger:!0})}),this.extractView.el.find(".drop.plus").on("vclick",function(e){$(this).closest(".details").toggleClass("collapsed expanded"),e.preventDefault(),e.stopPropagation()}),this.extractView.el.find(".add-to-cart").on("vclick",function(t){var n=$(this);n.hasClass("loading")||(n.addClass("loading").removeClass("success fail"),e.addToCart().always(function(){n.removeClass("loading")}).done(function(){n.addTempClass("success",1500)}).fail(function(){n.addTempClass("fail",1500)})),t.preventDefault(),t.stopPropagation()}),0===this.data.stock_level&&this.extractView.el.addClass("out-of-stock")}}),Shop=Backbone.Model.extend({initialize:function(){this.initEvents(),Einzlstck.Models.Copy=new Lang("de"),Einzlstck.Deferreds.copy.then(function(){})},initEvents:function(){$(document).on("vclick",".cart-button",function(e){var t=$(e.currentTarget),n=$(".hamburger-button");t.hasClass("open")?Einzlstck.Models.Cart.view.close():(Einzlstck.Models.Cart.view.open(),n.removeClass("open"),$("header nav").removeClass("open")),e.preventDefault(),e.stopPropagation()}),$(document).on("vclick",".hamburger-button",function(e){var t=$(e.currentTarget),n=$(".cart-button");t.hasClass("open")?(t.removeClass("open"),$("header nav").removeClass("open"),$("body").removeClass("no-scroll-mobile")):(t.addClass("open"),$("header nav").addClass("open"),$("body").addClass("no-scroll-mobile"),n.removeClass("open"),$("aside.cart-container").removeClass("open")),e.preventDefault(),e.stopPropagation()})},getTemplate:function(e){return $.get("/templates/"+e).then(function(e){return Einzlstck.Deferreds.copy.then(function(t){return e=Einzlstck.Models.Copy.insertCopy(e,t),Handlebars.compile(e)})})},askServer:function(e){return $.ajax({type:"POST",dataType:"json",url:"php/ajax.php",data:e}).done(function(){}).fail(function(t,n,s){console.log("AJAX Call failed"),console.log("tried to send this data:"),console.log(e),console.log("response data:"),console.log(t),console.log(n),console.log(s)})},subscribe:function(e){var t={action:"subscribe",user:e};return this.askServer(t).done(function(e){console.log("user successfully subscribed"),console.log(e),notifyUser(Einzlstck.Models.Copy.data.messages.nl_subscribed,"success")}).fail(function(e){console.log("something is wrong with that email"),console.log(e),notifyUser(Einzlstck.Models.Copy.data.messages.nl_error,"error")})}});$(document).ready(function(){window.Einzlstck={Pages:{},Models:{},Views:{},Deferreds:{products:$.Deferred(),copy:$.Deferred()}},Einzlstck.Models.Shop=new Shop,Einzlstck.Models.Inventory=new Inventory,Einzlstck.Models.User=new User,Einzlstck.Models.Cart=new Basket,Einzlstck.Router=new Router(config),Einzlstck.Deferreds.products.then(function(){Backbone.history.start({pushState:!0})})});var Basket=Backbone.Model.extend({initialize:function(){var e=this;this.view=new BasketView,this.getCart().then(function(){e.view.render(e.data).then(function(){})})},removeItem:function(e){var t=this,n={action:"removeFromCart",cart:{id:t.data.id},product:{key:e,quantity:t.data.contents[e].quantity}};return Einzlstck.Models.Shop.askServer(n).done(function(e){t.data=e.cart,t.view.render(t.data).then(function(){})})},addItem:function(e){var t=this,n={action:"addToCart",cart:{id:t.data.id},product_id:e};return Einzlstck.Models.Shop.askServer(n).done(function(e){t.data=e.cart,console.log(e),t.view.render(t.data).then(function(){})})},getCart:function(){var e=this,t={action:"getCart"};return Einzlstck.Models.Shop.askServer(t).done(function(t){t.cart?(e.data=t.cart,Einzlstck.Models.User.data.cart_id=t.cart.id,Einzlstck.Models.User.saveToLocalstorage()):notifyUser(Einzlstck.Models.Copy.data.messages.noConnection,"error")})}}),CheckoutModel=PageModel.extend({initialize:function(e){this.data=e,this.view=new CheckoutView(this.data.hbsPath),this.view.model=this},processOrder:function(){console.log("process order");var e,t,n=$.Deferred(),s={},i=$("#billing-address"),a=i.find(".user-address-list .selected").first();if(!(a.length>0))return goToByScroll(i),notifyUser(Einzlstck.Models.Copy.data.messages.checkout_noBillingAddress,"error"),n.reject();e=a.attr("data-address-id"),$.each(Einzlstck.Models.User.data.addresses,function(){return this.id===e?(t=this,!1):void 0}),s.billAd=t;var o,r,l=$("#shipping-address"),d=l.find(".user-address-list .selected").first();if(!(d.length>0))return goToByScroll(l),notifyUser(Einzlstck.Models.Copy.data.messages.checkout_noShippingAddress,"error"),n.reject();if(o=d.attr("data-address-id"),$.each(Einzlstck.Models.User.data.addresses,function(){return this.id===o?(r=this,!1):void 0}),s.shipAd=r,!Einzlstck.Models.Cart||Einzlstck.Models.Cart.data.total_items<=0)return notifyUser(Einzlstck.Models.Copy.data.messages.checkout_empty_cart,"error"),n.reject();var c=$("#payment-choice"),u=c.find('[name="paymentOption"]:checked').val();s.payment=u,s.shipping="6846";var h={action:"processOrder",order:s,cart:Einzlstck.Models.Cart.data};return Einzlstck.Models.Shop.askServer(h).done(function(e){console.log(e),"manual"===e.payment?window.location="/gateway?manual=1&orderID="+e.order.result.id:window.open(e.payment.result.url)})},trackOrder:function(e){ga("require","ecommerce"),ga("ecommerce:addTransaction",{id:e.id,affiliation:"Einzelstück",revenue:e.total,shipping:e.shipping_price,tax:"0",currency:"EUR"}),$.each(e.cart.contents,function(e,t){ga("ecommerce:addItem",{id:e,name:t.name,sku:t.sku,category:t.category.value,price:t.total,quantity:t.quantity})}),ga("ecommerce:send")}}),OrderModel=PageModel.extend({initialize:function(e){var t=this;this.data=e,this.view=new OrderView(this.data.hbsPath),this.view.model=this,this.getOrder(this.data.order.id).then(function(){t.view.render(t.data).then(function(){t.handlePayment()})})},handlePayment:function(){"Paid"===this.data.order.status.value||"Dispatched"===this.data.order.status.value?this.view.el.find("#paid").show():this.view.el.find("#pay-manual").show()},initGateway:function(e){if("paypal-express"===e){this.view.el.find("#pay-paypal").show();var t=this.view.el.find(".button.pay");t.addClass("loading");var n={action:"processPayment",orderID:this.data.order.id};Einzlstck.Models.Shop.askServer(n).then(function(e){console.log(e),t.removeClass("loading"),e.payment.status&&e.payment.result.url&&t.on("vclick",function(){window.open(e.payment.result.url)})})}else this.view.el.find("#pay-manual").show()},getOrder:function(e){var t=this,n={action:"getOrder",orderID:e};return Einzlstck.Models.Shop.askServer(n).done(function(e){console.log(e),e.order.status&&(t.data.order=e.order.result)})}}),Lang=Backbone.Model.extend({initialize:function(e){this.language=e,this.getCopy()},getCopy:function(){var e=this;return $.getJSON("copy/"+this.language+".json",function(t){Einzlstck.Deferreds.copy.resolve(t.copy),e.data=t.copy})},insertCopy:function(e,t){var n=$("<div></div>").append(e);return n.find("[data-copy]").each(function(){var e=t[$(this).attr("data-copy")];$(this).html(e)}),n.find("[data-placeholder]").each(function(){var e=t.placeholders[$(this).attr("data-placeholder")];$(this).attr("placeholder",e)}),n.html()}}),GatewayModel=PageModel.extend({initialize:function(e){this.data=e,window.clearTimeout(Einzlstck.Models.User.sayHello()),this.handleGatewayResponse()},confirmOrder:function(e){Einzlstck.Models.Cart=new Basket,Einzlstck.Router.navigate("/confirmation/"+e.id,{trigger:!0,replace:!0})},cancelOrder:function(){Einzlstck.Router.navigate("/checkout",{trigger:!0,replace:!0})},handleGatewayResponse:function(){var e=this;console.log("handle gateway response");var t={action:"completePayment"};$.extend(t,this.data.urlParams),Einzlstck.Models.Shop.askServer(t).then(function(t){console.log("complete payment response: "),console.log(t),"manual"===t.payment?e.confirmOrder(t.order.result):t.payment.status?(notifyUser("Dein Zahlvorgang war erfolgreich.","success"),e.confirmOrder(t.order.result)):(notifyUser("Bei der Zahlung ging etwas schief :-(","error"),e.cancelOrder())})}}),Inventory=Backbone.Collection.extend({model:ProductModel,initialize:function(){this.getProducts()},selectProduct:function(e){return this.get(e)},getProducts:function(){var e=this,t={action:"getProducts"};return Einzlstck.Models.Shop.askServer(t).done(function(t){t&&t.status?(e.add(t.result),Einzlstck.Deferreds.products.resolve(t)):notifyUser(Einzlstck.Models.Copy.data.messages.noConnection,"error")})}}),User=Backbone.Model.extend({data:{addresses:[]},views:{addressList:null,addressForm:null},sayHello:_.once(function(){var e=window.setTimeout(function(){notifyUser(Einzlstck.Models.Copy.data.messages.welcome[getRandomInt(0,Einzlstck.Models.Copy.data.messages.welcome.length-1)],"success")},2e3);return e}),initialize:function(){this.getFromLocalStorage(),this.views.addressList=new AddressList,this.views.addressForm=new AddressForm,this.sayHello()},saveToLocalstorage:function(){isLocalStorageNameSupported()&&(localStorage.einzl_user=JSON.stringify(this.data))},getFromLocalStorage:function(){if(isLocalStorageNameSupported()&&localStorage.einzl_user){var e=JSON.parse(localStorage.einzl_user);$.extend(this.data,e)}},addAddress:function(e){return this.data.addresses.push(e),this.saveToLocalstorage(),this.views.addressList.render(this.data).then(function(){})}});