function getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function removeSlash(e){return e.replace(/\/$/,"")}function goToByScroll(e){$("html,body").animate({scrollTop:e.offset().top-65},"slow")}function isLocalStorageNameSupported(){var e="test",t=window.sessionStorage;try{return t.setItem(e,"1"),t.removeItem(e),!0}catch(i){return!1}}function notifyUser(e,t){var i=$("#notification"),n=i.find(".message");i.addClass(t).removeClass("hide"),n.text(e),clearTimeout(t1),clearTimeout(t2),t1=window.setTimeout(function(){i.addClass("hide"),t2=window.setTimeout(function(){i.removeClass(t),n.text("")},1e3)},3500)}var App=function(){this.updateFromLocalStorage(),this.initRouting(),this.initNavigation(),this.getProducts()};App.prototype.updateFromLocalStorage=function(){if(isLocalStorageNameSupported()&&localStorage.einzl_user){var e=JSON.parse(localStorage.einzl_user);$.extend(einzl.user,e)}},App.prototype.getProducts=function(){var e=this,t={action:"getProducts"};return this.askServer(t).done(function(t){t&&t.status?e.getTemplate("modules/product").then(function(e){einzl.templates.product=e,$.each(t.result,function(e){einzl.products[e]=new Product(this)}),einzl.deferreds.product.resolve()}):(console.log("GET PRODUCTS FAILED"),console.log(t))})},App.prototype.askServer=function(e){return $.ajax({type:"POST",dataType:"json",url:"php/ajax.php",data:e}).done(function(){}).fail(function(t,i,n){console.log("AJAX Call failed"),console.log("tried to send this data:"),console.log(e),console.log("response data:"),console.log(t),console.log(i),console.log(n)})},App.prototype.initNavigation=function(){$(".hamburger-button").on("vclick",function(){$("header nav").toggleClass("open")}),$(".cart-button").on("vclick",function(){$("aside.cart-container").toggleClass("open")}),this.initAppRoutingLinks()},App.prototype.initAppRoutingLinks=function(){Modernizr.history&&($("a").off("vclick"),$("a").not('[target="_blank"]').on("vclick",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).attr("href"),i=$(this).attr("title"),n=window.location.pathname;n!==t&&History.pushState("",i,t)}))},App.prototype.subscribe=function(e){var t={action:"subscribe",user:e};return this.askServer(t).done(function(){console.log("user successfully subscribed")}).fail(function(){console.log("something is wrong with that email")})},App.prototype.findDestination=function(e){var t=null;return $.each(config.routes,function(){var i=!1;return $.each(this.slug,function(t,n){return n===e?(i=!0,!1):void 0}),i?(t=this,!1):void 0}),t?t:this.findDestination("/404")},App.prototype.route=function(e){e||(e=removeSlash(window.location.pathname)),console.log("route to: "+e);var t=this.findDestination(e);einzl.pages[t.id]&&einzl.pages[t.id].view.length>0?einzl.pages[t.id].start():(einzl.pages[t.id]=new Page(t),einzl.pages[t.id].start()),document.title=t.title,ga("send","pageview")},App.prototype.getTemplate=function(e){return $.get("/templates/"+e+".hbs").then(function(e){return Handlebars.compile(e)})},App.prototype.initRouting=function(){var e=this,t=window.History;t.Adapter.bind(window,"statechange",function(){t.getState();e.route(null)})},$(document).ready(function(){window.einzl={pages:{},user:{likes:{}},products:[],templates:{},deferreds:{product:new $.Deferred}},einzl.app=new App,einzl.app.route(null),einzl.cart=new Cart,ga("create","UA-46833918-1","auto")}),function(e,t,i,n,o,a,r){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,a=t.createElement(i),r=t.getElementsByTagName(i)[0],a.async=1,a.src=n,r.parentNode.insertBefore(a,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga");var Cart=function(){var e=this;this.getTemplate().then(function(){e.createView(),e.view.appendTo($(".cart"))})};Cart.prototype.getTemplate=function(){var e=this;return einzl.app.getTemplate("modules/cart").then(function(t){e.template=t})},Cart.prototype.createView=function(){var e=this.template();this.view=$(e)};var config={routes:[{title:"Home",id:"home",slug:["/home","/",""],hbsPath:"/pages/home"},{title:"Ringe",id:"rings",slug:["/ringe"],hbsPath:"/pages/ringe"},{title:"Ketten",id:"ketten",slug:["/ketten"],hbsPath:"/pages/ketten"},{title:"Armbänder",id:"bracelets",slug:["/armbaender"],hbsPath:"/pages/armbaender"},{title:"Impressum",id:"imprint",slug:["/impressum"],hbsPath:"/pages/impressum"},{title:"Developer Page",id:"f12",slug:["/f12"],hbsPath:"/pages/f12"},{title:"404",id:"404",slug:["/404"],hbsPath:"/pages/404"}],messages:{welcome:["Hi du :-)","Willkommen bei Einzelstück","Hey, schön dich zu sehen :-)"]}},t1,t2,Page=function(e){this.model=e};Page.prototype.createView=function(){var e=this;return einzl.app.getTemplate(this.model.hbsPath).then(function(t){var i=t();e.view=$(i),$.when(einzl.deferreds.product).then(function(){e.insertProducts()}),e.initController()})},Page.prototype.initController=function(){this.view.find(".newsletter-form").each(function(){var e=$(this),t=e.find('input[type="email"]'),i=e.find('button.subscribe[type="submit"]');i.on("vclick",function(n){if(!i.hasClass("loading"))if(n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault(),e[0].checkValidity()&&t.val().length>0){i.addClass("loading");var o={email:t.val()};einzl.app.subscribe(o).then(function(){i.removeClass("loading"),t.val("")})}else t.addClass("error"),t.one("focus",function(){t.removeClass("error")})})})},Page.prototype.insertProducts=function(){this.view.find("[data-product]").each(function(){var e=$(this),t=parseInt(e.attr("data-product"));$.each(einzl.products,function(){var i=this.model.id;return t===i?(this.view.appendTo(e),!1):void 0})})},Page.prototype.start=function(){var e=this;this.view?(einzl.pages.active=this,$("main").children("section").detach(),$(window).scrollTop(0),this.view.appendTo($("main"))):this.createView().then(function(){e.start()})};var Product=function(e){this.model=e,this.createView()};Product.prototype.createView=function(){var e=einzl.templates.product(this.model);this.view=$(e),this.initController()},Product.prototype.initController=function(){var e=this;einzl.user.likes[this.model.id]&&this.view.find(".drop.like").addClass("liked"),this.view.find(".drop.like").on("vclick",function(){$(this).toggleClass("liked");var t=$(this).hasClass("liked");t?ga("send","event","product",e.model.id,"liked"):ga("send","event","product",e.model.id,"unliked"),einzl.user.likes[e.model.id]=t,isLocalStorageNameSupported()&&(localStorage.einzl_user=JSON.stringify(einzl.user))})};